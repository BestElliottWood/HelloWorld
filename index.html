<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>dtmtest</title>
  <style>
    body {
      color: #454545;
      font-size: 14px;
      padding: 12px;
    }

    table {
      text-align: center;
      border-collapse: collapse;
    }

    tr,
    th,
    td {
      border-width: 0;
      border-style: solid;
      border-color: #e1e1e1;
    }

    th {
      background-color: lightcyan;
    }

    th,
    td {
      padding: 6px 12px;
      border-top-width: 1px;
      border-left-width: 1px;
    }

    th:last-child,
    td:last-child {
      border-right-width: 1px;
    }

    tr:last-child td {
      border-bottom-width: 1px;
    }

    input,
    select {
      padding: 10px 6px;
      border: 1px solid lightblue;
      line-height: 0;
      font-size: 1em;
      font-family: Arial, Helvetica, sans-serif;
    }

    input:focus,
    select:focus {
      outline: 1px solid skyblue;
    }

    button,
    .btn {
      display: inline-block;
      min-width: 120px;
      padding: 8px 12px;
      margin: 6px 12px 6px 0;
      color: #454545;
      font-size: 1em;
      text-align: center;
      border: 1px solid lightblue;
      background-color: white;
      cursor: pointer;
    }

    button:hover,
    .btn:hover {
      color: white;
      background-color: skyblue;
    }

    button:focus {
      outline: 1px solid lightblue;
    }

    h2 {
      margin: 12px 0 24px;
      /* line-height: 0; */
    }

    .pane {
      width: 1000px;
      padding: 8px;
      margin-top: 24px;
      min-width: 1200px;
      border: 1px solid #e1e1e1;
    }

    #pdd {
      display: none;
      margin-top: 20px;
      width: 80px;
      height: 40px;
      background: blueviolet;
    }

    .layout-item {
      display: inline-block;
      vertical-align: top;
      margin-right: 24px;
    }

    .result-line p {
      margin-bottom: 12px;
    }

    .box-outline {
      outline: 2px solid yellowgreen;
    }
  </style>

<!-- BEGIN SHAREAHOLIC CODE -->
<link rel="preload" href="https://cdn.shareaholic.net/assets/pub/shareaholic.js" as="script" />
<meta name="shareaholic:site_id" content="acb4a32218e336de99b6c23ca6363b31" />
<script data-cfasync="false" async src="https://cdn.shareaholic.net/assets/pub/shareaholic.js"></script>
<!-- END SHAREAHOLIC CODE -->
</head>

<body>
  <div style="height: 10000px;width: 10000px">
    <button onclick="window.location = 'demo1.html'">跳转</button>
    <p>i am entry page</p>
    <div class="pane">
      <h2>历史记录变更</h2>
      <div>
        <a class="btn" href="#delete">delete</a>
        <button onclick="window.location.hash='edit'">edit</button>
      </div>
      <div>
        <button onclick="window.history.back()">back</button>
        <button onclick="window.history.forward()">forward</button>
        <button onclick="window.history.go(-1)">go</button>
      </div>
      <div>
        <button onclick="history.pushState({page: 1}, 'title 1', '?page=1')">page 1</button>
        <button onclick="history.replaceState({page: 2}, 'title 2', '?page=2')">page 2</button>
      </div>
    </div>
    <div class="pane">
      <h2>元素可见性</h2>
      <button onclick="control()">显示/隐藏</button>
      <div id="pdd" class="haha"></div>
      <div style="height: 200px; margin-top: 12px;">
        <div><button id="btn_all" onclick="display(-1)">全部显示</button></div>
        <div style="display: inline-block; vertical-align: top; margin-right: 12px;">
          <button id="btn_1" onclick="display(0)">显示</button>
          <div id="block_1" class="block" style="width: 100px; height: 80px; background-color: orchid; display: none;">
            方块1</div>
        </div>
        <div style="display: inline-block; vertical-align: top; margin-right: 12px;">
          <button id="btn_2" onclick="display(1)">显示</button>
          <div id="block_2" class="block" style="width: 100px; height: 80px; background-color: pink; display: none;">方块2
          </div>
        </div>
        <div style="display: inline-block; vertical-align: top; margin-right: 12px;">
          <button id="btn_3" onclick="display(2)">显示</button>
          <div id="block_3" class="block" style="width: 100px; height: 80px; background-color: gray; display: none;">方块3
          </div>
        </div>
        <div style="display: inline-block; vertical-align: top; margin-right: 12px;">
          <button id="btn_4" onclick="display(3)">显示</button>
          <div id="block_4" class="block" style="width: 100px; height: 80px; background-color: orange; display: none;">
            方块4</div>
        </div>
      </div>
      <script>
        var isVisible = !1;
        var showAll = false;
        var visibleArray = [0, 0, 0, 0];

        function display(index) {
          index = Number(index);
          var curVisible = false;
          if (index > -1) {
            curVisible = !visibleArray[index];
            displayHandler(index + 1, curVisible);
            showAll = visibleArray.filter(item => item).length === visibleArray.length;
            document.getElementById('btn_all').innerHTML = curVisible ? '全部隐藏' : '全部显示';
          } else {
            curVisible = !showAll;
            document.getElementById('btn_all').innerHTML = curVisible ? '全部隐藏' : '全部显示';
            for (var i = 0, len = visibleArray.length; i < len; i++) {
              displayHandler(i + 1, curVisible);
            }
            showAll = curVisible;
          }
        }

        function displayHandler(index, status) {
          document.getElementById('btn_' + index).innerHTML = status ? '隐藏' : '显示';
          document.getElementById('block_' + index).style.display = status ? 'block' : 'none';
          visibleArray[index - 1] = status;
        }

        function control() {
          var _div = document.getElementById('pdd');
          _div.style.display = isVisible ? 'none' : 'block';
          isVisible = !isVisible;
        }
      </script>
    </div>
    <div class="pane">
      <h2>视频</h2>
      <div id="player"></div>

      <!-- <script>
        // 2. This code loads the IFrame Player API code asynchronously.
        var tag = document.createElement('script');

        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        
        var player;

        function onYouTubeIframeAPIReady() {
          player = new YT.Player('player', {
            height: '360',
            width: '640',
            videoId: 'M7lc1UVf-VE',
            events: {
              'onReady': onPlayerReady,
              'onStateChange': onPlayerStateChange
            }
          });
        }
        
        function onPlayerReady(event) {
          event.target.playVideo();
        }
        
        var done = false;

        function onPlayerStateChange(event) {
          if (event.data == YT.PlayerState.PLAYING && !done) {
            setTimeout(stopVideo, 6000);
            done = true;
          }
        }

        function stopVideo() {
          player.stopVideo();
        }
      </script> -->
    </div>

    <div class="pane">
      <h2>xpath</h2>
      <div class="layout">
        <div class="layout-item">
          <table>
            <thead>
              <tr>
                <th>title 1</th>
                <th>title 2</th>
                <th>title 3</th>
                <th>title 4</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td id="apple" class="t-td" name="td-apple" data-text="v-apple">apple</td>
                <td id="orange" class="t-td" name="td-orange" data-text="v-orange">orange</td>
                <td id="watermalon" class="t-td" name="td-watermalon" data-text="v-watermalon">watermalon</td>
                <td id="banana" class="t-td" name="td-banana" data-text="v-banana">banana</td>
              </tr>
              <tr>
                <td id="shirt" class="t-td" name="shirt" data-text="v-shirt">shirt</td>
                <td id="dress" class="t-td" name="dress" data-text="v-dress">dress</td>
                <td id="jean" class="t-td" name="td-jean" data-text="v-jean">jean</td>
                <td id="shoe" class="t-td" name="td-shoe" data-text="v-shoe">shoe</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="layout-item">
          <select name="methodType" id="input-type">
            <option value="ID">ID</option>
            <option value="CSS">CSS</option>
            <option value="XPATH">XPath</option>
          </select>
          <input id="input-xpath" type="text" placeholder="请输入" />
          <!-- <input id="input-xpath" type="text" value="//table/tbody/tr[1]/td[last()-1]" placeholder="请输入" /> -->
          <input id="input-attribute" type="text" placeholder="请输入属性名" />
          <button onclick="handleClick()">获取DOM</button>
          <hr />
          <div class="result-line">
            <p>标签名：<span id="span-name"></span></p>
            <p>标签内容：<span id="span-value"></span></p>
            <p>属性名：<span id="attr-name"></span></p>
            <p>属性值：<span id="attr-value"></span></p>
          </div>
        </div>
      </div>
    </div>

    <div class="pane">
      <h2>CSS路径</h2>
      <button id="active" class="btn">激活/关闭</button>
      <p>CSS路径：<span id="css-path"></span></p>
    </div>
  </div>
  <!-- built files will be auto injected -->

  <script>
    /**
     * 生成一周日期
     */
    function getWeekTime() {
      return [...new Array(7)].map((j, i) => new Date(Date.now() + i * 8.64e7).toLocaleDateString());
    }

    /**
     * 判断是否为某类型
     * @param {any} target 
     * @param {string} type 
     * @return {boolean}
     */
    function isType(target, type) {
      let targetType = Object.prototype.toString.call(target).slice(8, -1).toLowerCase();
      return targetType === type.toLowerCase();
    }

    /**
     * 对象属性剔除
     * @param {object} object 
     * @param {string[]} props 
     * @return {object}
     */
    function omit(object, props = []) {
      let res = {};
      Object.keys(object).forEach(key => {
        if (!props.includes(key)) {
          res[key] = typeof object[key] === 'object' && object[key] !== null ?
            // 深度拷贝
            JSON.parse(JSON.stringify(object[key])) :
            object[key];
        }
      })
      return res;
    }

    /**
     * 日期格式化
     * @param {string} formate 
     * @param {number} timestamp - 时间戳
     * @returns {string}
     */
    function formatDate(formate = 'Y-M-D h:m', timestamp = Date.now()) {
      let date = new Date(timestamp);
      let dateInfo = {
        Y: date.getFullYear(),
        M: date.getMonth() + 1,
        D: date.getDate(),
        h: date.getHours(),
        m: date.getMinutes(),
        s: date.getSeconds()
      }
      let formatNumber = n => n > 10 ? n : `0${n}`;
      let res = format
        .replace('Y', dateInfo.Y)
        .replace('M', dateInfo.M)
        .replace('D', dateInfo.D)
        .replace('h', formatNumber(dateInfo.h))
        .replace('m', formatNumber(dateInfo.m))
        .replace('s', formatNumber(dateInfo.s));

      return res;
    }

    /**
     * 函数防抖
     * @param {fucntion} func - 执行函数
     * @param {number} wait - 等待时间
     * @param {boolean} immediate - 是否立即执行
     * @return {function}
     */
    function debounce(func, wait = 300, immediate) {
      let timer, ctx;
      let later = arg => setTimeout(() => {
        func.apply(ctx, arg);
        timer = ctx = null;
      }, wait);

      return function (...arg) {
        if (!timer) {
          timer = later(arg);
          ctx = this;
          if (immediate) {
            func.apply(ctx, arg);
          }
        } else {
          clearTimeout(timer);
          timer = later(arg);
        }
      }
    }

    /**
     * 函数节流
     * @param {function} func - 执行函数
     * @param {number} delay - 延迟时间
     * @return {function}
     */
    function throttle(func, delay) {
      let timer = null;
      return function (...arg) {
        if (!timer) {
          timer = setTimeout(() => {
            func.apply(this, arg);
            timer = null;
          }, delay)
        }
      }
    }

    /**
     * 识别浏览器及平台
     */
    function getPlatformInfo() {
      // 运行环境是浏览器
      let inBrowser = typeof window !== 'undefined';
      // 运行环境是微信
      let inWeex = typeof WXEnvironment !== 'undefined' && !!WXEnvironment.platform;
      let weexPlatform = inWeex && WXEnvironment.platform.toLowerCase();
      // 浏览器 UA 判断
      let UA = inBrowser && window.navigator.userAgent.toLowerCase();
      if (UA) {
        let platforms = {
          IE: /msie|trident/.test(UA),
          IE9: UA.indexOf('msie 9.0') > 0,
          Edge: UA.indexOf('edge/') > 0,
          Android: UA.indexOf('android') > 0 || (weexPlatform === 'android'),
          IOS: /iphone|ipad|ipod|ios/.test(UA) || (weexPlatform === 'ios'),
          Chrome: /chrome\/\d+/.test(UA) && !(UA.indexOf('edge/') > 0),
        }
        for (const key in platforms) {
          if (platforms.hasOwnProperty(key)) {
            if (platforms[key]) return key;
          }
        }
      }

    }

    /**
     * 获取目标元素完整的CSS路径
     * @param {node} el 
     * @return {string}
     */
    function getCSSPath(el) {
      if (!(el instanceof Element)) return;
      var path = [];
      // Node.ELEMENT_NODE: 1表示标签节点  3表示文本
      while (el.nodeType === Node.ELEMENT_NODE && el.tagName.toLowerCase() !== 'html') {
        var selector = el.nodeName.toLowerCase();
        // 如果节点有id则直接使用id，否则获取CSS选择器路径
        if (el.id) {
          selector += '#' + el.id;
        } else {
          var siblings = el.parentNode.children; // 获取所有的兄弟节点包括本身
          var isUnique = true; // 兄弟节点中不存在同名节点
          var site = 0; // 在兄弟节点中的位置
          for (var i = 0, len = siblings.length; i < len; i++) {
            // 判断元素节点位置，即父节点下的第几个子节点
            if (siblings[i].isSameNode(el)) { // Node.isSameNode 判断两个元素节点是否是同一个
              site = i + 1;
              continue;
            }
            // 判断兄弟节点中是否有同名标签
            if (siblings[i].nodeName.toLowerCase() === selector) {
              isUnique = false;
            }
          }
          if (!isUnique) {
            selector += ":nth-child(" + site + ")";
          }
        }
        path.unshift(selector);
        el = el.parentNode;
      }
      return path.join(" > ");
    }

    function hasClass(element, cName) {
      return element.className.match(new RegExp("(\\s|^)" + cName + "(\\s|$)"));
    }
    //为指定的dom元素添加样式
    function addClass(element, cName) {
      if (!hasClass(element, cName)) element.className += " " + cName;
    }
    //删除指定dom元素的样式
    function removeClass(element, cName) {
      if (hasClass(element, cName)) {
        var reg = new RegExp("(\\s|^)" + cName + "(\\s|$)");
        element.className = element.className.replace(reg, "");
      }

      if (!element.className) {
        element.removeAttribute('class');
      }
    }

    function parseURL(url) {
      var a = document.createElement('a');
      a.href = url;
      return {
        source: url,
        protocol: a.protocol.replace(':', ''),
        host: a.hostname,
        port: a.port,
        query: a.search,
        params: (function () {
          var ret = {},
            seg = a.search.replace(/^\?/, '').split('&'),
            len = seg.length,
            i = 0,
            s;
          for (; i < len; i++) {
            if (!seg[i]) {
              continue;
            }
            s = seg[i].split('=');
            ret[s[0]] = s[1];
          }
          return ret;
        })(),
        file: (a.pathname.match(/\/([^\/?#]+)$/i) || [, ''])[1],
        hash: a.hash.replace('#', ''),
        path: a.pathname.replace(/^([^\/])/, '/$1'),
        relative: (a.href.match(/tps?:\/\/[^\/]+(.+)/) || [, ''])[1],
        segments: a.pathname.replace(/^\//, '').split('/')
      };
    }
  </script>
  <script>
    // recordTier.push({
    //   'eventName': 'CustomEvent'
    // })
    var WINDOW_SC = {
      a: {
        aa: 12,
        ab: 23,
      },
      b: 3
    };

    var abc = 'color';

    function getVariable(virtualName) {
      if (virtualName) {
        var nameArray = String(virtualName).split('.');
        var keyName = nameArray.shift();
        var globalV = window[keyName];

        while (nameArray.length > 0 && globalV) {
          keyName = nameArray.shift();
          if (Object.prototype.hasOwnProperty.call(globalV, keyName)) {
            globalV = globalV[keyName];
          } else {
            break;
          }
        }
        return globalV;
      }

      return undefined;
    }

    function setCookie(name, value) {
      var Days = 30;
      var exp = new Date();
      exp.setTime(exp.getTime() + Days * 24 * 60 * 60 * 1000);
      document.cookie = name + "=" + escape(value) + ";expires=" + exp.toGMTString();
    }

    function handleClick() {
      var selectType = document.getElementById('input-type').value;
      var inputValue = document.getElementById('input-xpath').value || '';
      var attrName = document.getElementById('input-attribute').value || '';
      var nodes = selectType === 'ID' ? getDomByID(inputValue) :
        selectType === 'CSS' ? getDomBySelector(inputValue) :
        selectType === 'XPATH' ? getDomByXPath(inputValue) : [];
      displayResult(nodes, attrName);
    }

    function getDomByID(id) {
      if (id) {
        return [document.getElementById(id)]
      }
      return [];
    }

    // CSS选择器
    function getDomBySelector(selector) {
      if (selector) {
        return document.querySelectorAll(selector);
      }
      return [];
    }

    // XPath表达式
    function getDomByXPath(STR_XPATH) {
      var xnodes = [];
      if (document.evaluate) { //判断是否支持evaluate
        var xresult = document.evaluate(STR_XPATH, document, null, XPathResult.ANY_TYPE, null);

        var xres;
        while (xres = xresult.iterateNext()) {
          xnodes.push(xres);
        }
      } else {
        document.setProperty("SelectionLanguage", "XPath");
        xnodes = document.selectNodes(STR_XPATH);
      }

      return xnodes;
    }

    function displayResult(nodes, attrName) {
      var texts = [],
        attrs = [],
        tagNames = [],
        temp;
      if (nodes) {
        for (var i = 0, len = nodes.length; i < len; i++) {
          texts.push(nodes[i].innerHTML);
          attrName && attrs.push(nodes[i].getAttribute(attrName));
          temp = nodes[i].tagName.toLowerCase();
          tagNames.indexOf(temp) === -1 && tagNames.push(temp);
        }
      }

      document.getElementById('span-name').innerHTML = tagNames.join('、');
      document.getElementById('span-value').innerHTML = texts.join('、');
      document.getElementById('attr-name').innerHTML = attrName;
      document.getElementById('attr-value').innerHTML = attrs.join('、');
    }

    setCookie('name', 'age=4;country=USA');

    function startQuery() {
      window.document.body.onmouseover = function (event) {
        let el = event.target;
        addClass(el, 'box-outline');
      };
      window.document.body.onmouseout = function (event) {
        let el = event.target;
        removeClass(el, 'box-outline');
      };
      window.document.body.onmousedown = function (event) {
        let el = event.target;
        let cssPath = getCSSPath(el);

        document.getElementById("css-path").innerHTML = cssPath;
      };
    }

    function endQuery() {
      window.document.body.onmouseover = null;
      window.document.body.onmouseout = null;
      window.document.body.onmousedown = null;
    }

    let isActive = false;
    document.getElementById('active').onclick = function () {
      if (isActive) {
        endQuery();
        isActive = false;
      } else {
        startQuery();
        isActive = true;
      }
    }

    var referrer = document.referrer;
    var myURL = parseURL('www.baidu.com');
    // console.log(referrer, myURL);

    window.onpopstate = function (event) {
      alert("location: " + document.location + ", state: " + JSON.stringify(event.state));
    };
  </script>
</body>

</html>
